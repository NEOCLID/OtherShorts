# Deploy Backend to Railway.app (5 Minutes)

Railway.app is a Platform-as-a-Service that makes deployment incredibly simple. No server management required!

---

## ‚úÖ What You Get

- ‚úÖ Automatic HTTPS/SSL
- ‚úÖ Auto-restart on crashes
- ‚úÖ Auto-deploy on GitHub push
- ‚úÖ Built-in monitoring
- ‚úÖ Custom domain support
- ‚úÖ Free $5/month credit (enough for testing)

---

## üìã Prerequisites

- GitHub account (you already have this)
- Railway account (we'll create this)
- Your backend code pushed to GitHub (you already did this)

---

## üöÄ Step 1: Create Railway Account

1. Go to https://railway.app
2. Click **Login**
3. Choose **Login with GitHub**
4. Authorize Railway to access your GitHub

**You get $5 free credit per month!**

---

## üöÄ Step 2: Deploy Your Backend

### A. Create New Project

1. Click **New Project**
2. Select **Deploy from GitHub repo**
3. Choose your repository: **`NEOCLID/OtherShorts`**
4. Railway will auto-detect it's a Node.js project

### B. Configure Build Settings

Railway should auto-detect, but if needed:

1. Click on your service
2. Go to **Settings** tab
3. **Root Directory**: Leave blank (or set to `/` if it asks)
4. **Build Command**: `npm install` (auto-detected)
5. **Start Command**: `node server/server.js`

### C. Add Environment Variables

1. Click **Variables** tab
2. Click **+ New Variable**
3. Add these **one by one**:

```bash
# Database (your existing RDS)
DB_USER=postgres
DB_HOST=othershorts-db.xxxxxxx.us-east-1.rds.amazonaws.com
DB_NAME=othershorts
DB_PASSWORD=YOUR_RDS_PASSWORD
DB_PORT=5432

# Google OAuth (from your .env)
EXPO_PUBLIC_EXPO_CLIENT_ID=874054853041-0vbn26ekopo5o36079cje63acp567amk.apps.googleusercontent.com
EXPO_PUBLIC_WEB_CLIENT_ID=874054853041-46orv6vs3l5uauju1fnajgl3tjijghdk.apps.googleusercontent.com
EXPO_PUBLIC_ANDROID_CLIENT_ID=874054853041-lhci3mj5ap0ijbpn507vpm13s935j5bb.apps.googleusercontent.com

# YouTube API
YOUTUBE_API_KEY=REDACTED_GOOGLE_API_KEY

# Node Environment
NODE_ENV=production
```

4. Click **Deploy** (Railway will redeploy automatically)

---

## üöÄ Step 3: Get Your Railway URL

1. After deployment completes (1-2 minutes), click **Settings**
2. Scroll to **Domains**
3. You'll see a Railway-provided URL like:
   ```
   https://othershorts-production.up.railway.app
   ```
4. **Copy this URL!**

---

## üöÄ Step 4: Test Your Backend

Open your Railway URL in browser:

```
https://othershorts-production.up.railway.app/api/countries
```

**Expected response:**
```json
[{"id":1,"name":"Korea"},{"id":2,"name":"Others"}]
```

‚úÖ If you see this, your backend is LIVE!

---

## üöÄ Step 5: Add Custom Domain (api.othershorts.com)

### A. Add Domain to Railway

1. In Railway, go to **Settings** ‚Üí **Domains**
2. Click **+ Custom Domain**
3. Enter: `api.othershorts.com`
4. Railway will show you a CNAME record to add

**Example:**
```
Type: CNAME
Name: api
Value: othershorts-production.up.railway.app
```

### B. Update Your DNS

Go to your domain registrar (where you bought othershorts.com):

1. Add a **CNAME record**:
   ```
   Type: CNAME
   Name: api
   Value: othershorts-production.up.railway.app
   TTL: 300 (5 minutes)
   ```

2. Save changes

3. **Wait 5-30 minutes** for DNS propagation

### C. Verify Custom Domain

After DNS propagates, test:

```
https://api.othershorts.com/api/countries
```

‚úÖ SSL certificate is automatically generated by Railway!

---

## üöÄ Step 6: Update Your App Configuration

Now that backend is live, update your app to use the Railway URL:

### Edit `config.js`:

```javascript
const DEV_API = 'http://localhost:3000';
const DEV_MOBILE_API = 'http://192.168.0.16:3000';
const PROD_API = 'https://api.othershorts.com';  // ‚Üê Now this works!

export const API_IP = __DEV__
  ? (typeof document !== 'undefined' ? DEV_API : DEV_MOBILE_API)
  : PROD_API;  // ‚Üê Remove the WEB_TEST_API workaround
```

### Rebuild and Redeploy:

```bash
# Rebuild web
npx expo export --platform web

# Deploy to S3
.\deploy-web-to-s3.ps1

# Rebuild Android (if needed)
cd android && ./gradlew bundleRelease
```

---

## üöÄ Step 7: Update Google OAuth Redirect URIs

Your backend is now on a new domain, so update Google OAuth:

1. Go to [Google Cloud Console](https://console.cloud.google.com/apis/credentials)
2. Edit your OAuth 2.0 Client IDs
3. Add **Authorized redirect URIs**:
   ```
   https://api.othershorts.com
   https://othershorts-production.up.railway.app
   ```
4. Add **Authorized JavaScript origins**:
   ```
   https://api.othershorts.com
   https://othershorts-production.up.railway.app
   http://othershorts.s3-website-ap-southeast-2.amazonaws.com
   ```

---

## üîÑ Auto-Deploy on Push (Bonus!)

Railway automatically deploys when you push to GitHub!

**Workflow:**
```bash
# Make changes to your code
git add .
git commit -m "Update backend"
git push origin master

# Railway automatically:
# 1. Detects the push
# 2. Builds your app
# 3. Deploys it
# 4. Restarts the server
```

**No manual deployment needed!** üéâ

---

## üìä Monitoring & Logs

### View Logs

1. In Railway dashboard, click your service
2. Click **Deployments** tab
3. Click the latest deployment
4. View **Build Logs** and **Deploy Logs**

### Monitor Usage

1. Go to **Metrics** tab
2. See:
   - CPU usage
   - Memory usage
   - Network traffic
   - Request count

### Set Up Alerts (Optional)

1. Click **Settings**
2. **Notifications** ‚Üí Add your email
3. Get notified if service crashes

---

## üí∞ Cost Breakdown

### Free Tier
- **$5 credit/month**
- Covers ~500-1000 active hours
- Perfect for testing and small apps

### Paid Tier (if you exceed free tier)
- **$5-10/month** for typical usage
- Pay only for what you use
- No minimum commitment

**Estimate for OtherShorts:**
- 730 hours/month (24/7)
- ~500 API requests/day
- **Cost**: $5-7/month

---

## üîß Troubleshooting

### "Service keeps crashing"

**Check logs:**
1. Railway dashboard ‚Üí **Deployments**
2. View **Deploy Logs**
3. Look for errors

**Common issues:**
- Missing environment variables
- Database connection failed (check RDS security group allows Railway IPs)
- Wrong start command

### Database Connection Failed

**Problem**: RDS doesn't allow Railway's IP addresses

**Solution**: Update RDS security group to allow all IPs (0.0.0.0/0) temporarily, then restrict to Railway's IPs:

1. Go to [AWS RDS Console](https://console.aws.amazon.com/rds/)
2. Click `othershorts-db` ‚Üí **VPC security groups**
3. Edit inbound rules ‚Üí Add rule:
   ```
   Type: PostgreSQL
   Port: 5432
   Source: 0.0.0.0/0 (or Railway's IP range)
   ```

### Environment Variables Not Loading

**Problem**: `.env` file doesn't exist on Railway

**Solution**: All environment variables must be added via Railway dashboard (we already did this in Step 2C)

### Custom Domain Not Working

**Problem**: DNS not propagated yet

**Solution**:
- Wait 30 minutes
- Check DNS: `nslookup api.othershorts.com`
- Verify CNAME points to Railway URL

---

## üîí Security Best Practices

### 1. Rotate Exposed Secrets

Your YouTube API key was in git history:
1. Go to [Google Cloud Console](https://console.cloud.google.com/apis/credentials)
2. Create new API key
3. Update in Railway dashboard ‚Üí **Variables**
4. Delete old key

### 2. Use Railway Secrets

For sensitive values, use Railway's secret variables:
1. Click **Variables** tab
2. Toggle **Raw Editor**
3. Format:
   ```
   DB_PASSWORD=${{secrets.DB_PASSWORD}}
   ```

### 3. Enable Railway Private Networking (Optional)

If you want extra security:
1. Use Railway PostgreSQL instead of RDS
2. Enable private networking between services

---

## üéØ Quick Reference

### Useful Railway Commands

```bash
# Install Railway CLI (optional)
npm install -g @railway/cli

# Login
railway login

# Link to project
railway link

# View logs
railway logs

# Run command on Railway
railway run node server/server.js

# Add environment variable
railway variables set KEY=VALUE
```

### Your URLs

- **Railway URL**: https://othershorts-production.up.railway.app
- **Custom Domain**: https://api.othershorts.com
- **S3 Web App**: http://othershorts.s3-website-ap-southeast-2.amazonaws.com

---

## ‚úÖ Success Checklist

After deployment, verify:

- [ ] Railway shows "Active" status
- [ ] `https://api.othershorts.com/api/countries` returns JSON
- [ ] Web app on S3 can login successfully
- [ ] Android app can connect to backend
- [ ] Google OAuth works with new domain
- [ ] Database queries work (check Railway logs)
- [ ] Auto-deploy on GitHub push works

---

## üÜò Need Help?

- **Railway Docs**: https://docs.railway.app
- **Railway Discord**: https://discord.gg/railway
- **Railway Status**: https://status.railway.app

---

## üéâ You're Done!

Your backend is now:
- ‚úÖ Running 24/7 on Railway
- ‚úÖ Connected to AWS RDS database
- ‚úÖ Accessible at api.othershorts.com
- ‚úÖ Auto-deploying on git push
- ‚úÖ With automatic SSL/HTTPS

**Total deployment time**: 5-10 minutes! üöÄ

---

## Next Steps

1. **Deploy backend to Railway** (follow this guide)
2. **Update config.js** to use `api.othershorts.com`
3. **Rebuild and redeploy web app** to S3
4. **Test login** on S3 web app
5. **Build final Android AAB** with production backend
6. **Upload to Google Play**

You're almost ready for production! üéä
